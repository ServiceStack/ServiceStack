<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link type="text/css" rel="Stylesheet" href="testLib.css" />
    <script type="text/javascript" src="testLib.js"></script>

    <script type="text/javascript" src="../js/all"></script>
    <script type="text/javascript" src="../jsLibOnLoad/all"></script>
    <script type="text/javascript" src="src/all"></script>
    
    <script type="text/javascript">

        var Dom = YAHOO.util.Dom,
			Assert = YAHOO.util.Assert,
			ArrayAssert = YAHOO.util.ArrayAssert,
			DateAssert = YAHOO.util.DateAssert,
			ObjectAssert = YAHOO.util.ObjectAssert,
			UserAction = YAHOO.util.UserAction;

        var Class = AjaxStack.Class,
            Path = AjaxStack.Path,
            H = AjaxStack.Html,
            is = AjaxStack.is,
            S = AjaxStack.StringExt,
            O = AjaxStack.ObjectExt, 
            A = AjaxStack.ArrayExt;

        
        /* Redis Test Utils */
        var redis = new RedisClient("http://localhost/RedisWebServices.Host/Public/");

        var redisAssertValue = function(key, expected) {
            return function(value) {
                redis.getValue(key, function(value) {
                    Assert.areEqual(expected, value);
                }, failFn);
            }
        };

        var testKey = "testkey";
        var testValue = "Hello";
        var stringValues = [ "A", "B", "C" ];
        var intValues = [ 1, 2, 3 ];

        var failFn = function(error) {
            alert("error: " + S.toString(error));
            Assert.fail("onErrorFn called" + S.toString(error));
        }
        var resume = this.resume;

        var onAfterFlushAllAndSetTeskKey = function(onSuccessFn, onErrorFn)
        {
            redis.flushAll(function(){
                redis.setEntry(testKey, testValue, onSuccessFn, onErrorFn);
            }, onErrorFn || failFn);
        };

        var onAfterFlushAllAndAllStringValuesSet = function(onSuccessFn, onErrorFn)
        {
            var i = 0;
            redis.flushAll(function() {
                for (var i in stringValues) {
                    redis.setEntry(stringValues[i], stringValues[i], function() {
                        if (i++ == stringValues.length - 1) onSuccessFn();
                    }, onErrorFn || failFn);
                }
            }, onErrorFn || failFn);
        };
        

        /* Import and run all test suites */
        var classTestSuite = new YAHOO.tool.TestSuite("Redis UI Suite");
        for (var name in YAHOO.ajaxstack)
        {
            var testCase = YAHOO.ajaxstack[name];
            classTestSuite.add(testCase);
        }

	    YAHOO.util.Event.onDOMReady(function()
	    {
	        //create the logger
	        var logger = new YAHOO.tool.TestLogger("testLogger");
	        YAHOO.tool.TestRunner.add(classTestSuite);

	        //run the tests
	        YAHOO.tool.TestRunner.run();
	    });	    
    </script>

</head>
<body>

</body>
</html>
